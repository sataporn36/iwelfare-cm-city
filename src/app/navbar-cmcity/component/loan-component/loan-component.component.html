<div class="card-table">
    <p-chip label="ตารางประวัติการส่งเงินกู้รายเดือน (Loan History)" styleClass="mr-2"></p-chip>
    <div style="padding-bottom: 1rem; display: flex; justify-content: flex-end;">
        <button type="button" class="btn btn-login" (click)="exportMakePDF('export')">Export PDF</button>
        &nbsp;&nbsp;
        <button type="button" class="btn btn-login" (click)="exportMakePDF('download')">Download PDF</button>
    </div>
    <div style="font-family: 'Kanit';">
        <p-table dataKey="id" [value]="dataLoanDetail" [loading]="loading" [paginator]="true" [rows]="10"
            [showCurrentPageReport]="true" selectionMode="single"
            currentPageReportTemplate="แสดง {first} ถึง {last} จาก {totalRecords} รายการ"
            [tableStyle]="{'max-width': '100%'}" [rowsPerPageOptions]="[10, 50, 100]">
            <ng-template pTemplate="header">
                <tr>
                    <th style="width:10%">ลำดับที่</th>
                    <th style="width:15%">เดือนที่ทำรายการ</th>
                    <th style="width:15%">ปีที่ทำรายการ</th>
                    <th style="width:15%">ชื่อรายการ</th>
                    <th style="width:10%">งวดที่</th>
                    <th style="width:15%">เงินกู้สามัญ</th>
                    <th style="width:15%">ดอกเบี้ย (%)</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-loanDetail let-i="rowIndex">
                <tr [pSelectableRow]="loanDetail">
                    <td>{{ i+1 }}</td>
                    <td>{{ loanDetail.loanMonth }}</td>
                    <td>{{ loanDetail.loanYear }}</td>
                    <td>ชำระหนี้ประจำเดือน</td>
                    <td style="color: #EA3A3D;">{{ loanDetail.installment }}</td>
                    <td style="color: #1AD598;">{{ loanDetail.loanOrdinary }}</td>
                    <td>{{ loanDetail.interestPercent }}%</td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>
<div style="padding-top: 1rem;"></div>

<div class="card-table" *ngIf="admin">
    <p-chip label="ผู้ดูแลระบบ (Admin)" styleClass="mr-2"></p-chip>
    <p-toast></p-toast>
    <div style="padding-bottom: 0.5rem; padding-top: 1rem; display: flex; justify-content: space-between;">
        <div>
            <button type="button" class="btn btn-login" style="width: 100%;">เรียกเก็บชำระเงินกู้รายเดือน</button>
        </div>
        <div>
            <button type="button" class="btn btn-login" (click)="exportMakePDF('export')">Export PDF</button>
            &nbsp;&nbsp;
            <button type="button" class="btn btn-login" (click)="exportMakePDF('download')">Download PDF</button>
        </div>
    </div>

    <p-table #dt2 [value]="dataLoan" dataKey="id" editMode="row" [rows]="10" [showCurrentPageReport]="true"
        [rowsPerPageOptions]="[10, 25, 50]" [loading]="loading" [paginator]="true" selectionMode="single"
        currentPageReportTemplate="แสดง {first} ถึง {last} จาก {totalRecords} รายการ"
        [globalFilterFields]="['employeeCode', 'firstName', 'lastName', 'stockValue', 'stockAccumulate' ]"
        [tableStyle]="{'max-width': '100%'}">
        <ng-template pTemplate="caption">
            <div class="flex" style="display: flex; justify-content: space-between;">
                <span style="margin-top: 10px; font-weight: normal; font-size: 18px;"> ตารางประวัติการส่งเงินกู้รายเดือน (Loan History) </span>
                <span class="p-input-icon-left ml-auto">
                    <i class="bi bi-search" style="color: #979797; display: flex;"></i>
                    <input pInputText type="text" (input)="dt2.filterGlobal($event.target.value, 'contains')"
                        placeholder="ค้นหา" style="width: 10rem; border-radius: 10px; height: 45px; font-size: 15px;" />
                </span>
            </div>
        </ng-template>

        <ng-template pTemplate="header">
            <tr>
                <th style="width:10%">ลำดับที่</th>
                <th style="width:10%">รหัสพนักงาน</th>
                <th style="width:10%">ชื่อ</th>
                <th style="width:10%">นามสกุล</th>
                <th style="width:10%">เงินหุ้นส่งรายเดือน</th>
                <th style="width:10%">หุ้นสะสม</th>
                <th style="width:10%">แก้ไข</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-editing="editing" let-dataLoan let-ri="rowIndex">
            <tr [pEditableRow]="dataLoan">
                <td>{{ dataLoan.id }}</td>
                <td>{{ dataLoan.employeeCode }}</td>
                <td>{{ dataLoan.firstName }}</td>
                <td>{{ dataLoan.lastName }}</td>
                <td style="color: #EA3A3D;">{{ dataLoan.loanValue }}</td>
                <td style="color: #1AD598;">{{ dataLoan.loanBalance }}</td>
                <td style="display: flex; justify-content: center;">
                    <div class="flex align-items-center justify-content-center gap-2" style="height: 25px; display: flex;">
                        <button pButton pRipple type="button" icon="pi pi-lock" tooltipPosition="top" pTooltip="ปิดหนี้"
                            (click)="onCloseLoan(dataLoan)" class="p-button-rounded p-button-text"></button>
                    </div>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="5">No customers found.</td>
            </tr>
        </ng-template>
    </p-table>
</div>
<div style="padding-top: 2rem;"></div>

<p-dialog [(visible)]="displayModal" [modal]="true" [style]="{width: '28vw'}" [draggable]="false" [resizable]="false"
    styleClass="customDialog">
    <ng-template pTemplate="header">
        <div style="display: flex; align-items: center;">
            <span style="font-size: 18px; font-weight: bold;">เปลี่ยนแปลงการชำระเงินกู้รายเดือน</span>
            <i class="pi pi-info-circle" style="font-size: 1rem; padding-left: 0.5rem;" tooltipPosition="bottom"
                pTooltip="เปลี่ยนแปลงเงินกู้รายเดือนของสมาชิกทั้งหมด"></i>
        </div>
    </ng-template>
    <div [formGroup]="formModelLoan">
        <div class="test-child" style="display: grid; justify-content: center; padding: 10px;">
            <div class="col-12 " style="display: flex; justify-content: center;">
                <div class="col-6">
                    <label class="block">เงินกู้รายเดือน *</label>
                    <p-inputNumber formControlName="monthlyLoanMoney" inputId="minmaxfraction" mode="decimal"
                        [required]="true" [minFractionDigits]="2" [maxFractionDigits]="2" [maxlength]="10"
                        (onInput)="checkValueOfNull($event)"></p-inputNumber>
                </div>
            </div>
        </div>
    </div>
    <ng-template pTemplate="footer">
        <button type="button" class="btn btn-login2" (click)="onupdateLoanToMonth()"
            [disabled]="checkNull">ยืนยัน</button>
        <button type="button" class="btn btn-regis2" (click)="onCancle()">ยกเลิก</button>
    </ng-template>
</p-dialog>

<p-confirmDialog #cd [appendTo]="'body'" position="center" [draggable]="false" [dismissableMask]="true"
    [style]="{width: '18vw'}">
    <ng-template pTemplate="footer">
        <button type="button" class="btn btn-login" (click)="cd.accept()">ยืนยัน</button>
        <button type="button" class="btn btn-login" (click)="cd.reject()">ยกเลิก</button>
    </ng-template>
</p-confirmDialog>