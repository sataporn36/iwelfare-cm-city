# user nginx
# worker_processes auto;
# error_log /var/log/nginx/error.log;
# pid /var/run/nginx.pid;

# events {
#     worker_connections 1024;
# }

# http {
#     include /etc/nginx/mime.types
#     default_type application/octet-stream;

#     access_log /var/log/nginx/access.log;
#     error_log /var/log/nginx/error.log;

#     sendfile on;
#     keepalive_timeout 65;

#     server {
#       listen 80;
#       server_name http://203.159.93.121;

#       location / {
#         proxy_pass http://localhost:3000;
#         proxy_http_version 1.1;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection 'upgrade';
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         proxy_cache_bypass $http_upgrade;
#       }

#     #   error_page  404     /404.html;
#     #   error_page  403     /403.html;

#     #   # To allow POST on static pages
#     #   error_page  405     =200 $uri;
#     }
# }
# # http {
# #     server {
# #         listen       80;
# #         server_name  http://203.159.93.121;

# #         root   /path/to/html;
# #         index  index.html index.htm;

# #         location / {
# #             try_files $uri $uri/ =404;
# #         }

# #         error_page  404     /404.html;
# #         error_page  403     /403.html;
# #         error_page  405     /405.html;

# #         location = /405.html {
# #             root   /path/to/html;
# #         }
# #     }
# # }


# # Set the number of worker processes based on the number of CPU cores
# worker_processes auto;

# # Set the events section to optimize the performance of the server
# events {
#   worker_connections 1024;
# }

# http {
#   # Set the MIME types that Nginx will serve
#   types {
#     text/html  html;
#     text/css   css;
#     text/javascript  js;
#     image/png  png;
#     image/jpeg jpg;
#     image/gif  gif;
#     application/javascript  js;
#   }

#   # Configure the default server
#   server {
#     # Listen on port 80
#     listen 80;

#     # Set the root directory for serving files
#     root /usr/share/nginx/html;

#     # Enable gzip compression to reduce the size of transmitted data
#     gzip on;
#     gzip_types text/html text/css text/javascript image/png image/jpeg image/gif application/javascript;

#     # Serve index.html as the default file
#     index index.html;

#     # Set caching headers for static resources
#     location ~* \.(js|css|png|jpg|gif)$ {
#       expires 1y;
#       add_header Cache-Control "public";
#     }

#     # Rewrite all requests to the index.html file
#     location / {
#       try_files $uri $uri/ /index.html;
#     }
#   }
# }

# user  nginx;
# worker_processes  auto;

# events {
#     worker_connections  1024;
# }

# http {
#     include       /etc/nginx/mime.types;
#     default_type  application/octet-stream;
#     access_log  /var/log/nginx/access.log;
#     error_log   /var/log/nginx/error.log;

#     sendfile        on;
#     keepalive_timeout  65;

#     # server {
#     #     listen       80;
#     #     server_name  localhost;

#     #     root   /usr/share/nginx/html;
#     #     index  index.html;

#     #     location / {
#     #         try_files $uri $uri/ /index.html;
#     #     }
#     # }

#     location /api/ {
#             proxy_pass http://203.159.93.121:8787/;  # Replace with the URL of your Spring Boot backend
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header Host $host;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         }
# }

# worker_processes auto;
# events {
#     worker_connections 1024;
# }

# http {
#     include mime.types;
#     default_type application/octet-stream;
#     sendfile on;
#     keepalive_timeout 65;

#     server {
#         listen 80;
#         server_name localhost;  # Replace with your domain or IP address

#         root /usr/share/nginx/html;  # Replace with the path to your Angular app's "dist" folder

#         # index index.html;

#         location / {
#             try_files $uri $uri/ /index.html;
#         }

#         # location /api/ {
#         #     proxy_pass http://203.159.93.121:8787/;  # Replace with the URL of your Spring Boot backend
#         #     proxy_set_header X-Real-IP $remote_addr;
#         #     proxy_set_header Host $host;
#         #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         # }
#     }   
# }


user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events 
{
     worker_connections 768;
     # multi_accept on;
}

http 
{
    # upstream springboot
    # {
    #     server localhost:8080  max_conns=10;
    # }

    server {
        listen 80;
        listen [::]:80;
        server_name 203.159.93.121;

        location / {
          # root   /usr/share/nginx/html;
          try_files $uri $uri/ /index.html;
          index  index.html index.htm;
          proxy_pass    http://localhost:5000;
          proxy_http_version 1.1;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
          proxy_set_header X-Forwarded-Port $server_port;
        }
        
       location /api {
          proxy_pass    http://203.159.93.121:8787;
          proxy_set_header    Host               $host;
          proxy_set_header    X-Real-IP          $remote_addr;
          proxy_set_header    X-Forwarded-For 
          $proxy_add_x_forwarded_for;
          proxy_set_header    X-Forwarded-Host   $host;
          proxy_set_header    X-Forwarded-Server $host;
          proxy_set_header    X-Forwarded-Port   $server_port;
          proxy_set_header    X-Forwarded-Proto  $scheme;        
        }
    }

        ##
        # Logging Settings
        ##

        access_log /var/log/nginx/access.log;
        error_log /var/log/nginx/error.log;

        ##
        # Gzip Settings
        ##

        gzip on;
}